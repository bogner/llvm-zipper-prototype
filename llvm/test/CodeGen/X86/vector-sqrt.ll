; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: llc < %s -mtriple=x86_64-unknown-unknown -mattr=+avx  | FileCheck %s --check-prefix=CHECK

; ModuleID = 'vector-sqrt.c'
source_filename = "vector-sqrt.c"
target datalayout = "e-m:e-i64:64-f80:128-n8:16:32:64-S128"
target triple = "x86_64-unknown-linux-gnu"

; Function Attrs: nounwind readonly uwtable
define <2 x double> @sqrtd2(double* nocapture readonly %v) local_unnamed_addr #0 {
; CHECK-LABEL: sqrtd2:
; CHECK:       # BB#0: # %entry
; CHECK-NEXT:    vsqrtsd (%rdi), %xmm0, %xmm0
; CHECK-NEXT:    vsqrtsd 8(%rdi), %xmm1, %xmm1
; CHECK-NEXT:    vunpcklpd {{.*#+}} xmm0 = xmm0[0],xmm1[0]
; CHECK-NEXT:    retq
entry:
  %0 = load double, double* %v, align 8, !tbaa !1
  %call = tail call double @sqrt(double %0) #2
  %arrayidx1 = getelementptr inbounds double, double* %v, i64 1
  %1 = load double, double* %arrayidx1, align 8, !tbaa !1
  %call2 = tail call double @sqrt(double %1) #2
  %vecinit.i = insertelement <2 x double> undef, double %call, i32 0
  %vecinit1.i = insertelement <2 x double> %vecinit.i, double %call2, i32 1
  ret <2 x double> %vecinit1.i
}

; Function Attrs: nounwind readnone
declare double @sqrt(double) local_unnamed_addr #1

; Function Attrs: nounwind readonly uwtable
define <4 x float> @sqrtf4(float* nocapture readonly %v) local_unnamed_addr #0 {
; CHECK-LABEL: sqrtf4:
; CHECK:       # BB#0: # %entry
; CHECK-NEXT:    vsqrtss (%rdi), %xmm0, %xmm0
; CHECK-NEXT:    vsqrtss 4(%rdi), %xmm1, %xmm1
; CHECK-NEXT:    vsqrtss 8(%rdi), %xmm2, %xmm2
; CHECK-NEXT:    vsqrtss 12(%rdi), %xmm3, %xmm3
; CHECK-NEXT:    vinsertps {{.*#+}} xmm0 = xmm0[0],xmm1[0],xmm0[2,3]
; CHECK-NEXT:    vinsertps {{.*#+}} xmm0 = xmm0[0,1],xmm2[0],xmm0[3]
; CHECK-NEXT:    vinsertps {{.*#+}} xmm0 = xmm0[0,1,2],xmm3[0]
; CHECK-NEXT:    retq
entry:
  %0 = load float, float* %v, align 4, !tbaa !5
  %call = tail call float @sqrtf(float %0) #2
  %arrayidx1 = getelementptr inbounds float, float* %v, i64 1
  %1 = load float, float* %arrayidx1, align 4, !tbaa !5
  %call2 = tail call float @sqrtf(float %1) #2
  %arrayidx3 = getelementptr inbounds float, float* %v, i64 2
  %2 = load float, float* %arrayidx3, align 4, !tbaa !5
  %call4 = tail call float @sqrtf(float %2) #2
  %arrayidx5 = getelementptr inbounds float, float* %v, i64 3
  %3 = load float, float* %arrayidx5, align 4, !tbaa !5
  %call6 = tail call float @sqrtf(float %3) #2
  %vecinit.i = insertelement <4 x float> undef, float %call, i32 0
  %vecinit1.i = insertelement <4 x float> %vecinit.i, float %call2, i32 1
  %vecinit2.i = insertelement <4 x float> %vecinit1.i, float %call4, i32 2
  %vecinit3.i = insertelement <4 x float> %vecinit2.i, float %call6, i32 3
  ret <4 x float> %vecinit3.i
}

; Function Attrs: nounwind readnone
declare float @sqrtf(float) local_unnamed_addr #1

attributes #0 = { nounwind readonly uwtable "correctly-rounded-divide-sqrt-fp-math"="false" "disable-tail-calls"="false" "less-precise-fpmad"="false" "no-frame-pointer-elim"="false" "no-infs-fp-math"="false" "no-jump-tables"="false" "no-nans-fp-math"="false" "no-signed-zeros-fp-math"="false" "no-trapping-math"="false" "stack-protector-buffer-size"="8" "target-cpu"="haswell" "target-features"="+aes,+avx,+avx2,+bmi,+bmi2,+cx16,+f16c,+fma,+fsgsbase,+fxsr,+lzcnt,+mmx,+movbe,+pclmul,+popcnt,+rdrnd,+rtm,+sse,+sse2,+sse3,+sse4.1,+sse4.2,+ssse3,+x87,+xsave,+xsaveopt" "unsafe-fp-math"="false" "use-soft-float"="false" }
attributes #1 = { nounwind readnone "correctly-rounded-divide-sqrt-fp-math"="false" "disable-tail-calls"="false" "less-precise-fpmad"="false" "no-frame-pointer-elim"="false" "no-infs-fp-math"="false" "no-nans-fp-math"="false" "no-signed-zeros-fp-math"="false" "no-trapping-math"="false" "stack-protector-buffer-size"="8" "target-cpu"="haswell" "target-features"="+aes,+avx,+avx2,+bmi,+bmi2,+cx16,+f16c,+fma,+fsgsbase,+fxsr,+lzcnt,+mmx,+movbe,+pclmul,+popcnt,+rdrnd,+rtm,+sse,+sse2,+sse3,+sse4.1,+sse4.2,+ssse3,+x87,+xsave,+xsaveopt" "unsafe-fp-math"="false" "use-soft-float"="false" }
attributes #2 = { nounwind readnone }

!llvm.ident = !{!0}

!0 = !{!"clang version 4.0.0 (trunk 289787)"}
!1 = !{!2, !2, i64 0}
!2 = !{!"double", !3, i64 0}
!3 = !{!"omnipotent char", !4, i64 0}
!4 = !{!"Simple C/C++ TBAA"}
!5 = !{!6, !6, i64 0}
!6 = !{!"float", !3, i64 0}
